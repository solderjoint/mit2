Протокол обмена «быстрыми» данными по шине CAN

Мастер производит циклический опрос модулей ввода/вывода. Используется расширенный идентификатор CAN пакетов (29 бит).

Формат идентификатора:
Биты 23-16 – адрес модуля приемника
Биты 15-8 – адрес модуля источника 
Бит 7 – флаг последнего фрагмента текста
Бит 6 – флаг быстрого обмена между модулями ввода/вывода
Бит 5 – флаг запрос/ответ 0=запрос (пакет с «быстрыми» данными от мастера), 1=ответ (пакет с «быстрыми» данными мастеру).
Биты 4-0, при нулевых битах 5,6 – индекс фрагмента текста
(Текстовая строка может быть длиной 32*8=256 байт).

Диапазон адресов «Модулей адресной токовой линии»: 0x20-0x27

Пример обмена быстрыми данными запроса от модуля 0x3f (Блок индикации) модулю (0x020), идентификаторы:
0x00203F40 – запрос
0x003F2060 – ответ

Пример. При приеме контроллером LPC1788, дамп четырех регистров:

CAN.RFS  CAN.RID  CAN.RDA  CAN.RDB 
80080400 00091100 204E4553 4C4C4C4C
80080400 00091101 4C4C4C4C 4C4C4C4C
80040400 00091182 48484C48 4C4C4C4C
               ^^
               1
                2
1. Флаг последнего фрагмента текста.
2. Индекс фрагмента текста.

Это передача строки от модуля В/В 0x11 модулю В/В 0x09 в трех пакетах. (текст в этих трех пакетах: “SEN LLLLLLLLLLLLHHLLLLLL”)

Пример. При приеме контроллером TM41231H6PZ, дамп четырех регистров:

CAN_O_IF2ARB1 =  0x0180
CAN_O_IF2ARB2 =  0xC033
CAN_O_IF2MCTL =  0x9487
CAN_O_IF2DA1  =  0x454C
CAN_O_IF2DA2  =  0x3144
CAN_O_IF2DB1  =  0x4E4F
CAN_O_IF2DB2  =  0x0D20

Это передача строки от модуля В/В 0xC0 модулю В/В 0x33 (Текст: «LED1ON »)
  

